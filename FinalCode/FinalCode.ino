#include<LedControl.h>

int DIN = 6;
int CS = 5;
int CLK = 4;
int soundsensor = 2;


int clap = 0;
long detection_range_start = 0;
long detection_range = 0;
int status_led=0;
int check_ngat=0;
int pos=0;
const int MaxN= 34;
LedControl lc= LedControl(DIN,CLK,CS,0);

void changeMode(){
    lc.clearDisplay(0);
    pos=0;
    status_led +=1 ;
    if(status_led > 2) status_led -= 3;
}

int sus[8]={ 0x00,0x1C,0x30,0x3C,0x3C,0x14,0x00,0x00 };

int PacMan[8][MaxN]={ {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0 },
                      {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0 },
                      {0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0 },
                      {0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0 },
                      {0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0,0 },
                      {0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0 },
                      {0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0 },
                      {0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,0,1,1,1,1,1,1,0,0,0,0,0 },
};

int PacMan2[8][MaxN]={ {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0 },
                      {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0 },
                      {0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0 },
                      {0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0 },
                      {0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,0,1,1,1,1,0,0,0,1,0,0,0 },
                      {0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0 },
                      {0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0 },
                      {0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0 },
};

int Word[8][MaxN]={ {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0 },
                    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0 },
                    {0,0,1,1,0,0,0,1,1,0,1,1,0,0,1,0,0,0,1,0,0,1,1,0,1,1,0,0,1,1,1,0,0,0 },
                    {0,1,0,0,1,0,0,1,0,1,0,1,0,0,1,1,0,0,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0 },
                    {0,1,0,0,0,0,0,1,0,0,0,1,0,0,1,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,1,0,1,0 },
                    {0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,0,1,0,0,0,1,1,1,1,1 },
                    {0,0,1,1,0,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,1,1,1,0 },
                    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0 },
};


void setup() {
  // put your setup code here, to run once:
  pinMode(soundsensor, INPUT);
  attachInterrupt(0, changeMode, RISING);
  lc.shutdown(0, true);
  lc.setIntensity(0, 1);
  lc.clearDisplay(0);
}

void loop() {

    
  if( status_led == 1 ){
    lc.shutdown(0,false);
      for(int j=0 ;j<8 ;j++){
              for(int i=0; i<8; i++){
                if(status_led != 1 ){pos=0; break;}
                int pac= PacMan[ j  ][ ( i+pos ) - ((i+pos)/MaxN)*MaxN ] ;
                if( pos%2 ) pac=  PacMan2[ j  ][ ( i+pos ) - ((i+pos)/MaxN)*MaxN ] ;
                
                lc.setLed(0,j,i,pac);
              }
            }
      delay(40);
      pos++;
      if(pos >= MaxN) pos-=MaxN;
    
    }

    if( status_led == 2 ){
    lc.shutdown(0,false);
      for(int j=0 ;j<8 ;j++){
              for(int i=0; i<8; i++){
                if(status_led != 2 ) {pos=0; break;}
                int bit= Word[ j  ][ ( i+pos ) - ((i+pos)/MaxN)*MaxN ] ;
               
                lc.setLed(0,j,i,bit);
              }
            }
      delay(40);
      pos++;
      if(pos >= MaxN) pos-=MaxN;
    }
    if(status_led == 0 ) {
      lc.shutdown(0,true);
      pos=0;
    }
}
